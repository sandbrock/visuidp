# Lambda Environment Profile
# Cost-optimized configuration for AWS Lambda deployment

# Enable Lambda mode
idp.lambda.enabled=true

# Database provider: DynamoDB for serverless deployment
idp.database.provider=dynamodb

# DynamoDB configuration (from environment variables)
idp.database.dynamodb.region=${DYNAMODB_REGION:us-east-1}
idp.database.dynamodb.table-prefix=${DYNAMODB_TABLE_PREFIX:visuidp}

# Disable Flyway (not needed for DynamoDB)
quarkus.flyway.migrate-at-start=false

# Disable Hibernate (not needed for DynamoDB)
quarkus.hibernate-orm.enabled=false

# Cost-optimized logging: ERROR level only
# Requirement 12.4: Minimize CloudWatch Logs ingestion costs
# CloudWatch Free Tier: 5GB ingestion, 10 alarms, 3 dashboards per month
# With error-level logging only, we stay well within Free Tier
quarkus.log.level=ERROR
quarkus.log.category."com.angryss.idp".level=ERROR
quarkus.log.category."org.hibernate".level=ERROR
quarkus.log.category."io.quarkus".level=ERROR
quarkus.log.category."software.amazon.awssdk".level=ERROR

# Disable access logs to reduce log volume
quarkus.http.access-log.enabled=false

# Lambda-specific HTTP configuration
quarkus.http.port=8080
quarkus.http.host=0.0.0.0

# Disable unnecessary features for Lambda
quarkus.smallrye-openapi.enable=false
quarkus.swagger-ui.enable=false

# Security configuration for Lambda
quarkus.http.auth.basic=false
quarkus.http.auth.proactive=false

# Admin group configuration
idp.security.admin-group=${ADMIN_GROUP:IDP-Admins}

# CORS configuration (CloudFront origin)
quarkus.http.cors=true
quarkus.http.cors.origins=${CORS_ORIGINS:*}
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS,HEAD
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors.access-control-allow-credentials=true

# Metrics configuration (use free AWS service metrics instead of custom metrics)
quarkus.micrometer.export.prometheus.enabled=false

# Health check configuration
quarkus.http.auth.permission.health.paths=/q/health/*
quarkus.http.auth.permission.health.policy=permit
