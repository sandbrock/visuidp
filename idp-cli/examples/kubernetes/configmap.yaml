apiVersion: v1
kind: ConfigMap
metadata:
  name: {{stack.name}}-config
  namespace: {{stack.name}}-{{environment|default:"dev"}}
  labels:
    app: {{stack.name}}
    managed-by: idp
data:
  # Application configuration
  APP_NAME: "{{stack.name}}"
  ENVIRONMENT: "{{environment|default:"dev"}}"
  STACK_TYPE: "{{stack.stack_type}}"
  CLOUD_NAME: "{{stack.cloud_name}}"
  
  # Logging configuration
  LOG_LEVEL: "{{log_level|default:"info"}}"
  LOG_FORMAT: "{{log_format|default:"json"}}"
  
  {{#if (eq stack.stack_type "RestfulApi")}}
  # API configuration
  API_PORT: "{{stack_resources[0].configuration.port|default:"80"}}"
  API_BASE_PATH: "{{api_base_path|default:"/api/v1"}}"
  API_TIMEOUT: "{{api_timeout|default:"30"}}"
  CORS_ENABLED: "{{cors_enabled|default:"true"}}"
  {{#if cors_origins}}
  CORS_ORIGINS: "{{cors_origins}}"
  {{/if}}
  {{/if}}
  
  {{#if enable_monitoring}}
  # Monitoring configuration
  METRICS_ENABLED: "true"
  METRICS_PORT: "{{metrics_port|default:"9090"}}"
  METRICS_PATH: "/metrics"
  TRACING_ENABLED: "{{tracing_enabled|default:"false"}}"
  {{/if}}
  
  {{#if cache_config}}
  # Cache configuration
  CACHE_ENABLED: "{{cache_config.enabled|default:"true"}}"
  CACHE_TTL: "{{cache_config.ttl|default:"3600"}}"
  CACHE_MAX_SIZE: "{{cache_config.max_size|default:"1000"}}"
  {{/if}}
  
  {{#if feature_flags}}
  # Feature flags
  {{#each feature_flags}}
  FEATURE_{{uppercase @key}}: "{{this}}"
  {{/each}}
  {{/if}}
  
  {{#if custom_config}}
  # Custom configuration
  {{#each custom_config}}
  {{@key}}: "{{this}}"
  {{/each}}
  {{/if}}
